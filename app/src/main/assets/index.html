<!--0.0.1-->
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eco-Engine</title>
<script src="engine.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
<style>
html, body {
  margin:0;
  padding:0;
  height:100%;
  background:#111;
  color:#0f0;
  font-family:monospace;
  overflow:hidden;
}
#barraFerramentas {
  display:flex;
  padding:5px;
}
#barraFerramentas select, input, button {
  margin-right:5px;
  background:#111;
  border:1px solid #444;
  color:#0f0;
  padding:5px;
  cursor:pointer;
}
#barraFerramentas input { width:120px; }
#conteudo {
  height:calc(100% - 42px);
  position:relative;
  background:#000;
}
.pagina {
  display:none;
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
}
.pagina.ativa { display:block; }
#telaJogo {
  width:550px;
  height:300px;
  background:#000;
  display:block;
  margin:auto;
  image-rendering:pixelated;
  position:absolute;
  top:0; bottom:0; left:0; right:0;
}
#editorCodigo {
  width:100%;
  height:100%;
}
#editorMapas {
  width:100%;
  height:100%;
  display:block;
}
</style>
</head>
<body>
<div id="barraFerramentas">
  <select id="listaPaginas" onchange="trocarPagina(this.value)">
    <option value="jogo">Jogo</option>
    <option value="editor">Editor</option>
    <option value="console">Console</option>
    <option value="editorTiles">Editor de mapas</option>
  </select>
  <button onclick="abrir()">Abrir</button>
  <input id="nomeArquivo" type="text" value="jogo.js">
  <button onclick="salvar()">Salvar</button>
  <button onclick="executar()">Rodar</button>
</div>
<div id="conteudo">
  <div id="editorTiles" class="pagina">
      <iframe id="editorMapas"></iframe>
  </div>
  <div id="jogo" class="pagina ativa">
    <canvas id="telaJogo"></canvas>
  </div>
  <div id="editor" class="pagina">
    <div id="editorCodigo"></div>
  </div>
  <div id="console" class="pagina">
    <div id="consoleLogs"></div>
  </div>
</div>
<script>
const engine = new Engine("telaJogo", true, false);
const editor = ace.edit("editorCodigo");
editor.setTheme("ace/theme/monokai");
editor.session.setMode("ace/mode/javascript");

function trocarPagina(id) {
  const paginas = document.querySelectorAll(".pagina");
  for(let i=0; i<paginas.length; i++) paginas[i].classList.remove("ativa");
  document.getElementById(id).classList.add("ativa");
  document.getElementById("editorMapas").src = "editorTiles.html";
}

function salvar() {
  const arq = document.getElementById("nomeArquivo").value.trim();
  Android.arquivar(arq, editor.getValue());
  Android.msg("Projeto salvo em: "+arq);
}

function abrir() {
  const arq = document.getElementById("nomeArquivo").value.trim();
  editor.setValue(Android.ler(arq), -1);
  Android.msg("Arquivo aberto");
}

function executar() {
  engine.limpar();
  eval(editor.getValue());
  Android.msg("Rodando");
}
</script>
</body>
</html>